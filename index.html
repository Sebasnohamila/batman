<!doctype html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <title>Experiencia 3D Bhastian</title>

    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>

    <style>
        /* El fondo base es negro (para el 3D) */
        body { margin: 0; overflow: hidden; font-family: 'Arial', sans-serif; background-color: #000; }

        /* --- UI DE CARGA E INICIO --- */
        #ui-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: #ffffff;
            z-index: 9999;
            display: flex; flex-direction: column; 
            justify-content: center; align-items: center;
            transition: opacity 0.8s ease-out;
            text-align: center;
        }

        #logo-img {
            max-width: 60%;
            height: auto;
            margin-bottom: 20px;
        }

        /* --- CONTENEDOR DE CARGA --- */
        #loader-container {
            display: flex; flex-direction: column; align-items: center;
        }

        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #D4AF37; /* Dorado */
            border-radius: 50%;
            width: 50px; height: 50px;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        .loading-text {
            color: #666;
            font-size: 14px;
            letter-spacing: 1px;
            animation: pulse 1.5s infinite;
        }

        /* --- CONTENEDOR DE INSTRUCCIONES (Oculto al inicio) --- */
        #ready-container {
            display: none; /* Se activa con JS */
            flex-direction: column;
            align-items: center;
            width: 80%;
        }

        .instructions-box {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            color: #333;
        }

        .inst-item {
            display: flex; flex-direction: column; align-items: center;
            font-size: 12px; color: #555;
        }
        
        /* Iconos SVG simples estilizables */
        .inst-icon {
            width: 40px; height: 40px;
            fill: #D4AF37; /* Iconos Dorados */
            margin-bottom: 5px;
        }

        /* Botón "VER EXPERIENCIA" */
        #start-btn {
            padding: 15px 40px;
            background-color: transparent;
            color: #D4AF37;
            border: 2px solid #D4AF37;
            font-size: 16px; font-weight: bold;
            cursor: pointer; border-radius: 50px;
            text-transform: uppercase; letter-spacing: 2px;
            transition: all 0.3s ease;
        }

        #start-btn:active {
            background-color: #D4AF37;
            color: #fff;
            transform: scale(0.95);
        }

        /* Animaciones */
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes pulse { 0% { opacity: 0.6; } 50% { opacity: 1; } 100% { opacity: 0.6; } }

        /* Botón de WhatsApp */
        #whatsapp-button {
            position: fixed; bottom: 20px; right: 20px; z-index: 9998;
            display: none;
            transition: transform 0.2s;
        }
        #whatsapp-button:active { transform: scale(0.9); }
        #whatsapp-button img { width: 60px; height: 60px; filter: drop-shadow(0px 4px 5px rgba(0,0,0,0.5)); }
    </style>

    <script>
        AFRAME.registerComponent('model-viewer', {
            init: function () {
                this.model = this.el;
                this.isInteractable = false;

                // Variables de gestos
                this.startX = 0;
                this.startY = 0;
                this.initialScaleVector = new THREE.Vector3();
                this.initialDistance = 0;

                // CONFIGURACIÓN DE LÍMITES
                this.limitRad = 30 * (Math.PI / 180); 
                
                // CONFIGURACIÓN DE ZOOM
                this.minScale = 0.012; 
                this.maxScale = 0.035; 

                // Referencias al DOM
                const uiLayer = document.getElementById('ui-layer');
                const loaderContainer = document.getElementById('loader-container');
                const readyContainer = document.getElementById('ready-container'); // Nuevo contenedor
                const startBtn = document.getElementById('start-btn');
                const waBtn = document.getElementById('whatsapp-button');
                const videoAudio = document.getElementById('vid');

                // OPTIMIZACIÓN DE RENDIMIENTO
                this.el.sceneEl.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 1.5));

                // 1. Evento: Cuando el modelo 3D termina de cargar
                this.el.addEventListener('model-loaded', () => {
                    console.log("Modelo cargado.");
                    
                    // OCULTAR CARGADOR Y MOSTRAR INSTRUCCIONES
                    loaderContainer.style.display = 'none';   
                    readyContainer.style.display = 'flex'; 
                    
                    // Corrección de materiales oscuros
                    this.el.object3D.traverse((node) => {
                        if (node.isMesh && node.material) {
                            node.material.metalness = 0;
                            node.material.roughness = 1;
                        }
                    });
                });

                // 2. Evento: Click en "Ver Experiencia"
                startBtn.addEventListener('click', () => {
                    // Desvanecer capa de carga
                    uiLayer.style.opacity = '0';
                    setTimeout(() => { uiLayer.style.display = 'none'; }, 800);

                    // Habilitar interacción y mostrar botón WA
                    this.isInteractable = true;
                    waBtn.style.display = 'block';

                    // Reproducir audio/video
                    if(videoAudio) {
                        videoAudio.play().then(() => { videoAudio.volume = 1.0; })
                        .catch(e => console.error("Error reproduciendo audio:", e));
                    }
                    // Iniciar animación del modelo
                    this.el.setAttribute('animation-mixer', 'timeScale: 1');
                });

                // 3. Gestos Táctiles (Touch Start)
                window.addEventListener('touchstart', (e) => {
                    if (!this.isInteractable) return;
                    if (e.touches.length === 1) {
                        this.startX = e.touches[0].clientX;
                        this.startY = e.touches[0].clientY;
                    } else if (e.touches.length === 2) {
                        const dx = e.touches[0].clientX - e.touches[1].clientX;
                        const dy = e.touches[0].clientY - e.touches[1].clientY;
                        this.initialDistance = Math.sqrt(dx * dx + dy * dy);
                        this.initialScaleVector.copy(this.el.object3D.scale);
                    }
                });

                // 4. Gestos Táctiles (Touch Move)
                window.addEventListener('touchmove', (e) => {
                    if (!this.isInteractable) return;

                    if (e.touches.length === 1) {
                        // --- ROTACIÓN ---
                        const deltaX = e.touches[0].clientX - this.startX;
                        const deltaY = e.touches[0].clientY - this.startY;

                        this.startX = e.touches[0].clientX;
                        this.startY = e.touches[0].clientY;

                        const speed = 0.005;

                        // Horizontal (Y)
                        let newRotY = this.el.object3D.rotation.y + (deltaX * speed);
                        newRotY = Math.max(-this.limitRad, Math.min(this.limitRad, newRotY));
                        this.el.object3D.rotation.y = newRotY;

                        // Vertical (X)
                        let newRotX = this.el.object3D.rotation.x + (deltaY * speed);
                        newRotX = Math.max(-this.limitRad, Math.min(this.limitRad, newRotX));
                        this.el.object3D.rotation.x = newRotX;

                    } else if (e.touches.length === 2 && this.initialDistance > 0) {
                        // --- ZOOM ---
                        const dx = e.touches[0].clientX - e.touches[1].clientX;
                        const dy = e.touches[0].clientY - e.touches[1].clientY;
                        const currentDistance = Math.sqrt(dx * dx + dy * dy);
                        
                        const scaleFactor = currentDistance / this.initialDistance;
                        let newS = this.initialScaleVector.x * scaleFactor;
                        
                        // Limitación del Zoom
                        newS = Math.max(this.minScale, Math.min(this.maxScale, newS));

                        this.el.object3D.scale.set(newS, newS, newS);
                    }
                });
            }
        });
    </script>
</head>

<body>
    <div id="ui-layer">
        <img id="logo-img" src="assets/logo.png" alt="Bhastian Logo">
        
        <div id="loader-container">
            <div class="loader"></div>
            <p class="loading-text">Espere mientras carga la experiencia...</p>
        </div>

        <div id="ready-container">
            
            <div class="instructions-box">
                <div class="inst-item">
                    <svg class="inst-icon" viewBox="0 0 24 24">
                        <path d="M9,11.24V7.5C9,6.12 10.12,5 11.5,5S14,6.12 14,7.5v3.74c1.21-0.81 2-2.18 2-3.74C16,5.01 13.99,3 11.5,3S7,5.01 7,7.5 c0,1.56 0.79,2.93 2,3.74z M18.66,12.35l-2.07-0.52C16.29,11.75 15.93,11.8 15.6,12l-1.1,0.63V7.5C14.5,5.84 13.16,4.5 11.5,4.5 S8.5,5.84 8.5,7.5v8.69l-3.32-0.7c-0.12-0.02-0.24-0.04-0.36-0.04c-0.42,0-0.81,0.17-1.11,0.47l-0.78,0.78l5.58,5.59 c0.67,0.67 1.58,1.05 2.53,1.05h6.39c1.6,0 2.97-1.16 3.23-2.73l0.55-3.29C21.43,15.65 20.35,14.05 18.66,12.35z"/>
                    </svg>
                    <span>1 dedo: Rotar</span>
                </div>

                <div class="inst-item">
                    <svg class="inst-icon" viewBox="0 0 24 24">
                        <path d="M21.5,13.8c-0.6-0.3-1.3,0-1.6,0.6l-1.3,2.4c-0.2,0.4-0.5,0.6-0.9,0.5c-0.4-0.1-0.6-0.4-0.5-0.8l1.7-6.2 c0.3-1.2-0.5-2.5-1.7-2.8c-1.2-0.3-2.5,0.5-2.8,1.7l-2.4,8.8c0,0.1-0.1,0.2-0.2,0.2c-0.1,0-0.2-0.1-0.2-0.2l0.8-2.9 c0.2-0.6-0.1-1.3-0.7-1.5c-0.6-0.2-1.3,0.1-1.5,0.7l-1,3.6c-0.5,1.9-1.3,3.7-2.4,5.3l-0.3,0.4c-0.2,0.3,0,0.7,0.4,0.7h13.1 c0.5,0,0.9-0.3,1-0.8l0.9-5.6C22,16.5,22.1,14.2,21.5,13.8z M9.1,11.9l2.4-8.8c0.8-2.8,3.6-4.5,6.4-3.8c2.8,0.8,4.5,3.6,3.8,6.4 l-1.7,6.2c-0.2,0.9-1.2,1.3-2,0.9c-0.4-0.2-0.6-0.5-0.7-0.9l1.3-2.4c0.9-1.6,0.3-3.6-1.3-4.5s-3.6-0.3-4.5,1.3l-1,3.6 c0.4-1.3,1.8-2.1,3.1-1.8c1.3,0.4,2.1,1.8,1.8,3.1l-0.8,2.9c-0.5-0.1-1-0.2-1.6-0.1L9.1,11.9z"/>
                    </svg>
                    <span>2 dedos: Zoom</span>
                </div>
            </div>

            <button id="start-btn">VER EXPERIENCIA</button>
        </div>

    </div>

    <a href="https://wa.me/593983088889?text=Hola%20Bhastian,%20vi%20su%20experiencia%203D" 
       target="_blank" id="whatsapp-button">
        <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp">
    </a>

    <a-scene 
        renderer="logarithmicDepthBuffer: true; colorManagement: true; antialias: false;"
        vr-mode-ui="enabled: false"
        loading-screen="enabled: false"
        background="color: #000000">

        <a-assets>
            <video id="vid" src="assets/xmen2.mp4" preload="auto" loop crossorigin="anonymous" playsinline></video>
            <a-asset-item id="miModelo" src="assets/PORTADAWOLVERINE2.glb"></a-asset-item>
        </a-assets>

        <a-entity light="type: ambient; intensity: 1.2; color: #ffffff"></a-entity>
        <a-entity light="type: directional; intensity: 1.5" position="2 4 4"></a-entity>

        <a-entity camera position="0 1.6 3.5" look-controls="enabled: false"></a-entity>

        <a-entity 
            id="animatedModel"
            gltf-model="#miModelo"
            scale="0.012 0.012 0.012"
            position="0 0 0" 
            rotation="0 0 0"
            model-viewer
        ></a-entity>

    </a-scene>
</body>
</html>
